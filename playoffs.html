<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link href="https://fonts.googleapis.com/css?family=Abhaya+Libre|Lato:300,700" rel="stylesheet">
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="js/sankey.js"></script>
	<link rel="icon" type="image/png" href="../images/favicon.png">
	<title>Playoff Seedings -- When do they matter most?</title>
</head>

<body>
<div>
	<h1 class = 'title'>For which sports do playoff seedings matter?</h1>
	<p class = 'author'>Musings, by Pete Hlawitschka</p>
	<p>This year, against all odds, the Cubs won the title, the Warriors blew a 3-1 lead, and the 15-1 Panthers lost in the Super Bowl. But should we be surprised? In all of these cases, the winning team was a 1-seed, the top ranked team on their side of the bracket, so why is everybody so surprised? (The Stanley Cup champion Penguins were a 2-seed).</p>

	 <p>In some sports, it seems like the highest-ranked teams always make it to the championship. In others, it seems like anything could happen. So I was curious to see -- in which sports are playoff seedings most predictive of the eventual champion?</p>
	
	<p>I scraped playoff and seed data for the four major sports: football, basketball, baseball, and hockey, going back to 1980. For a first look, I generated a few Sankey charts to show how far the different seeds make it in each sport. </p>

	<p>So how often does the top seed win it all for the four major sports? The top seed wins 70% of the time in the NBA, compared to just 40% in the MLB.</p>
	
	<p>CHART</p>
	
	<p>I have a few thoughts on why this might be. Some have to do with the sport -- scoring in basketball is not as random than in the other sports. NBA teams are averaging just under 100 posessions a game -- that's about 100 chances to score. NFL teams, by contrast, average about 12 posessions per game, MLB teams average 34 at bats per game, and NHL teams average about 30 shots on goal per game. The variance in score is what really matters. The playoff structure is also different between sports. The NFL uses a one-game format, whereas the other sports play longer series. </p>


	<p>We could do a couple of things. Regression. See with data viz. And look at different measures of predictiveness -- so not just the champion but also the last place. In other words, in which sport is it the biggest disadvantage to be last. Another metric would be in which sport are there the most upsets? And in which sport are there the biggest upsets? </p>

	<div class = 'row' style = 'text-align: center'>
		<div class = 'sankey' >NFL<p class = 'chart' id="nflchart"></p></div>
		<div class = 'sankey' >NBA<p class = 'chart'  id="nbachart"></p></div>
	</div>
	<div class = 'row' style = 'text-align: center'>
		<div class = 'sankey' >MLB<p class = 'chart'  id="mlb4chart"></p></div>
		<div class = 'sankey' >NHL<p class = 'chart'  id="nhlchart"></p></div>
	</div>


</div>

</body>




<!-- :::::::::::::::::::::::::::::::::::::: -->
<!-- NFL DATA -->
<!-- :::::::::::::::::::::::::::::::::::::: -->

<script>
	
	var margin = {top: 10, right: 10, bottom: 10, left: 10},
		width = 400 - margin.left - margin.right,
		height = 400 - margin.top - margin.bottom;

	// text display on hover
	var formatNumber = d3.format(",.2f"),    // two decimal places
		format = function(d) { return 100*formatNumber(d) + "% of the time"; },
		color = d3.scale.category20();

	// append the svg canvas to the page
	var svgNfl = d3.select("#nflchart").append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	  .append("g")
		.attr("transform", 
			  "translate(" + margin.left + "," + margin.top + ")");

	// Set the sankey diagram properties
	var sankey = d3.sankey()
		.nodeWidth(36)
		.nodePadding(40)
		.size([width, height]);

	var path = sankey.link();

	// load the data (using the timelyportfolio csv method)
	d3.csv("nflSummary.csv", function(error, data) {

	  //set up graph in same style as original example but empty
	  graph = {"nodes" : [], "links" : []};

		data.forEach(function (d) {
		  graph.nodes.push({ "name": d.source });
		  graph.nodes.push({ "name": d.target});
		  graph.links.push({ "source": d.source,
							 "target": d.target,
							 "value": +d.value });
		 });

		 // return only the distinct / unique nodes
		 graph.nodes = d3.keys(d3.nest()
		   .key(function (d) { return d.name; })
		   .map(graph.nodes));

		 // loop through each link replacing the text with its index from node
		 graph.links.forEach(function (d, i) {
		   graph.links[i].source = graph.nodes.indexOf(graph.links[i].source);
		   graph.links[i].target = graph.nodes.indexOf(graph.links[i].target);
		 });

		 //now loop through each nodes to make nodes an array of objects
		 // rather than an array of strings
		 graph.nodes.forEach(function (d, i) {
		   graph.nodes[i] = { "name": d };
		 });

	  sankey
		.nodes(graph.nodes)
		.links(graph.links)
		.layout(32);

	// add in the links
	  var link = svgNfl.append("g").selectAll(".link")
		  .data(graph.links)
		.enter().append("path")
		  .attr("class", "link")
		  .attr("d", path)
		  .style("stroke-width", function(d) { return Math.max(1, d.dy); })
		  .sort(function(a, b) { return b.dy - a.dy; });

	// add the link titles
	  link.append("title")
			.text(function(d) {
				return d.source.name + " → " + 
					d.target.name + "\n" + format(d.value); });

	// add in the nodes
	  var node = svgNfl.append("g").selectAll(".node")
		  .data(graph.nodes)
		.enter().append("g")
		  .attr("class", "node")
		  .attr("transform", function(d) { 
			  return "translate(" + d.x + "," + d.y + ")"; })
		.call(d3.behavior.drag()
		  .origin(function(d) { return d; })
		  .on("dragstart", function() { 
			  this.parentNode.appendChild(this); })
		  .on("drag", dragmove));

	// add the rectangles for the nodes
	  node.append("rect")
		  .attr("height", function(d) { return (d.dy); })
		  .attr("width", sankey.nodeWidth())
		  .style("fill", function(d) { 
			  return d.color = color(d.name.replace(/ .*/, "")); })
		  .style("stroke", function(d) { 
			  return d3.rgb(d.color).darker(2); })
		.append("title")
		  .text(function(d) { 
			  return d.name; });

	// add in the title for the nodes
	  node.append("text")
		  .attr("x", -6)
		  .attr("y", function(d) { return d.dy / 2; })
		  .attr("dy", ".35em")
		  .attr("text-anchor", "end")
		  .attr("transform", null)
		  .text(function(d) { return d.name; })
		.filter(function(d) { return d.x < width / 2; })
		  .attr("x", 6 + sankey.nodeWidth())
		  .attr("text-anchor", "start");

	// the function for moving the nodes
	  function dragmove(d) {
		d3.select(this).attr("transform", 
			"translate(" + d.x + "," + (
					d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))
				) + ")");
		sankey.relayout();
		link.attr("d", path);
	  }
	});

</script>



<!-- :::::::::::::::::::::::::::::::::::::: -->
<!-- NBA graph -->
<!-- :::::::::::::::::::::::::::::::::::::: -->

	<script>

	var margin = {top: 10, right: 10, bottom: 10, left: 10},
		width = 400 - margin.left - margin.right,
		height = 400 - margin.top - margin.bottom;

	// text display on hover
	var formatNumber = d3.format(",.2f"),    // two decimal places
		format = function(d) { return 100*formatNumber(d) + "% of the time"; },
		color = d3.scale.category20();

	// append the svg canvas to the page
	var svgNba = d3.select("#nbachart").append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	  .append("g")
		.attr("transform", 
			  "translate(" + margin.left + "," + margin.top + ")");

	// Set the sankey diagram properties
	var sankey = d3.sankey()
		.nodeWidth(36)
		.nodePadding(20)
		.size([width, height]);

	var path = sankey.link();

	// load the data (using the timelyportfolio csv method)
	d3.csv("nbaSummarySankey.csv", function(error, data) {

	  //set up graph in same style as original example but empty
	  graph = {"nodes" : [], "links" : []};

		data.forEach(function (d) {
		  graph.nodes.push({ "name": d.source });
		  graph.nodes.push({ "name": d.target });
		  graph.links.push({ "source": d.source,
							 "target": d.target,
							 "value": +d.value });
		 });

		 // return only the distinct / unique nodes
		 graph.nodes = d3.keys(d3.nest()
		   .key(function (d) { return d.name; })
		   .map(graph.nodes));

		 // loop through each link replacing the text with its index from node
		 graph.links.forEach(function (d, i) {
		   graph.links[i].source = graph.nodes.indexOf(graph.links[i].source);
		   graph.links[i].target = graph.nodes.indexOf(graph.links[i].target);
		 });

		 //now loop through each nodes to make nodes an array of objects
		 // rather than an array of strings
		 graph.nodes.forEach(function (d, i) {
		   graph.nodes[i] = { "name": d };
		 });

	  sankey
		.nodes(graph.nodes)
		.links(graph.links)
		.layout(32);

	// add in the links
	  var link = svgNba.append("g").selectAll(".link")
		  .data(graph.links)
		.enter().append("path")
		  .attr("class", "link")
		  .attr("d", path)
		  .style("stroke-width", function(d) { return Math.max(.01, d.dy); })
		  .style("opacity", function(d) { return d.dy; })
		  .sort(function(a, b) { return b.dy - a.dy; });

	// add the link titles
	  link.append("title")
			.text(function(d) {
				return d.source.name + " → " + 
					d.target.name + "\n" + format(d.value); });

	// add in the nodes
	  var node = svgNba.append("g").selectAll(".node")
		  .data(graph.nodes)
		.enter().append("g")
		  .attr("class", "node")
		  .attr("transform", function(d) { 
			  return "translate(" + d.x + "," + d.y + ")"; })
		.call(d3.behavior.drag()
		  .origin(function(d) { return d; })
		  .on("dragstart", function() { 
			  this.parentNode.appendChild(this); })
		  .on("drag", dragmove));

	// add the rectangles for the nodes
	  node.append("rect")
		  .attr("height", function(d) { return (d.dy); })
		  .attr("width", sankey.nodeWidth())
		  .style("fill", function(d) { 
			  return d.color = color(d.name.replace(/ .*/, "")); })
		  .style("stroke", function(d) { 
			  return d3.rgb(d.color).darker(2); })
		.append("title")
		  .text(function(d) { 
			  return d.name; });

	// add in the title for the nodes
	  node.append("text")
		  .attr("x", -6)
		  .attr("y", function(d) { return d.dy / 2; })
		  .attr("dy", ".35em")
		  .attr("text-anchor", "end")
		  .attr("transform", null)
		  .text(function(d) { return d.name; })
		.filter(function(d) { return d.x < width / 2; })
		  .attr("x", 6 + sankey.nodeWidth())
		  .attr("text-anchor", "start");

	// the function for moving the nodes
	  function dragmove(d) {
		d3.select(this).attr("transform", 
			"translate(" + d.x + "," + (
					d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))
				) + ")");
		sankey.relayout();
		link.attr("d", path);
	  }
	});

</script>



<!-- :::::::::::::::::::::::::::::::::::::: -->
<!-- MLB graph: 4 teams -->
<!-- :::::::::::::::::::::::::::::::::::::: -->
<script>

	var margin = {top: 10, right: 10, bottom: 10, left: 10},
		width = 400 - margin.left - margin.right,
		height = 400 - margin.top - margin.bottom;

	// text display on hover
	var formatNumber = d3.format(",.2f"),    // two decimal places
		format = function(d) { return 100*formatNumber(d) + "% of the time"; },
		color = d3.scale.category20();

	// append the svg canvas to the page
	var svgMlb4 = d3.select("#mlb4chart").append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	  .append("g")
		.attr("transform", 
			  "translate(" + margin.left + "," + margin.top + ")");

	// Set the sankey diagram properties
	var sankey = d3.sankey()
		.nodeWidth(36)
		.nodePadding(20)
		.size([width, height]);

	var path = sankey.link();

	// load the data (using the timelyportfolio csv method)
	d3.csv("mlbSummaryFourSeeds.csv", function(error, data) {

	  //set up graph in same style as original example but empty
	  graph = {"nodes" : [], "links" : []};

		data.forEach(function (d) {
		  graph.nodes.push({ "name": d.source });
		  graph.nodes.push({ "name": d.target });
		  graph.links.push({ "source": d.source,
							 "target": d.target,
							 "value": +d.value });
		 });

		 // return only the distinct / unique nodes
		 graph.nodes = d3.keys(d3.nest()
		   .key(function (d) { return d.name; })
		   .map(graph.nodes));

		 // loop through each link replacing the text with its index from node
		 graph.links.forEach(function (d, i) {
		   graph.links[i].source = graph.nodes.indexOf(graph.links[i].source);
		   graph.links[i].target = graph.nodes.indexOf(graph.links[i].target);
		 });

		 //now loop through each nodes to make nodes an array of objects
		 // rather than an array of strings
		 graph.nodes.forEach(function (d, i) {
		   graph.nodes[i] = { "name": d };
		 });

	  sankey
		.nodes(graph.nodes)
		.links(graph.links)
		.layout(32);

	// add in the links
	  var link = svgMlb4.append("g").selectAll(".link")
		  .data(graph.links)
		.enter().append("path")
		  .attr("class", "link")
		  .attr("d", path)
		  .style("stroke-width", function(d) { return Math.max(1, d.dy); })
		  .sort(function(a, b) { return b.dy - a.dy; });

	// add the link titles
	  link.append("title")
			.text(function(d) {
				return d.source.name + " → " + 
					d.target.name + "\n" + format(d.value); });

	// add in the nodes
	  var node = svgMlb4.append("g").selectAll(".node")
		  .data(graph.nodes)
		.enter().append("g")
		  .attr("class", "node")
		  .attr("transform", function(d) { 
			  return "translate(" + d.x + "," + d.y + ")"; })
		.call(d3.behavior.drag()
		  .origin(function(d) { return d; })
		  .on("dragstart", function() { 
			  this.parentNode.appendChild(this); })
		  .on("drag", dragmove));

	// add the rectangles for the nodes
	  node.append("rect")
		  .attr("height", function(d) { return (d.dy); })
		  .attr("width", sankey.nodeWidth())
		  .style("fill", function(d) { 
			  return d.color = color(d.name.replace(/ .*/, "")); })
		  .style("stroke", function(d) { 
			  return d3.rgb(d.color).darker(2); })
		.append("title")
		  .text(function(d) { 
			  return d.name; });

	// add in the title for the nodes
	  node.append("text")
		  .attr("x", -6)
		  .attr("y", function(d) { return d.dy / 2; })
		  .attr("dy", ".35em")
		  .attr("text-anchor", "end")
		  .attr("transform", null)
		  .text(function(d) { return d.name; })
		.filter(function(d) { return d.x < width / 2; })
		  .attr("x", 6 + sankey.nodeWidth())
		  .attr("text-anchor", "start");

	// the function for moving the nodes
	  function dragmove(d) {
		d3.select(this).attr("transform", 
			"translate(" + d.x + "," + (
					d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))
				) + ")");
		sankey.relayout();
		link.attr("d", path);
	  }
	});

</script>



<!-- :::::::::::::::::::::::::::::::::::::: -->
<!-- NHL graph -->
<!-- :::::::::::::::::::::::::::::::::::::: -->

<script>

	var margin = {top: 10, right: 10, bottom: 10, left: 10},
		width = 400 - margin.left - margin.right,
		height = 400 - margin.top - margin.bottom;

	// text display on hover
	var formatNumber = d3.format(",.2f"),    // two decimal places
		format = function(d) { return Math.round(100*formatNumber(d)) + "% of the time"; },
		color = d3.scale.category20();

	// append the svg canvas to the page
	var svgNhl = d3.select("#nhlchart").append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	  .append("g")
		.attr("transform", 
			  "translate(" + margin.left + "," + margin.top + ")");

	// Set the sankey diagram properties
	var sankey = d3.sankey()
		.nodeWidth(36)
		.nodePadding(20)
		.size([width, height]);

	var path = sankey.link();

	// load the data (using the timelyportfolio csv method)
	d3.csv("nhlSummary.csv", function(error, data) {

	  //set up graph in same style as original example but empty
	  graph = {"nodes" : [], "links" : []};

		data.forEach(function (d) {
		  graph.nodes.push({ "name": d.source });
		  graph.nodes.push({ "name": d.target });
		  graph.links.push({ "source": d.source,
							 "target": d.target,
							 "value": +d.value });
		 });

		 // return only the distinct / unique nodes
		 graph.nodes = d3.keys(d3.nest()
		   .key(function (d) { return d.name; })
		   .map(graph.nodes));

		 // loop through each link replacing the text with its index from node
		 graph.links.forEach(function (d, i) {
		   graph.links[i].source = graph.nodes.indexOf(graph.links[i].source);
		   graph.links[i].target = graph.nodes.indexOf(graph.links[i].target);
		 });

		 //now loop through each nodes to make nodes an array of objects
		 // rather than an array of strings
		 graph.nodes.forEach(function (d, i) {
		   graph.nodes[i] = { "name": d };
		 });

	  sankey
		.nodes(graph.nodes)
		.links(graph.links)
		.layout(32);

	// add in the links
	  var link = svgNhl.append("g").selectAll(".link")
		  .data(graph.links)
		.enter().append("path")
		  .attr("class", "link")
		  .attr("d", path)
		  .style("stroke-width", function(d) { return Math.max(1, d.dy); })
		  .sort(function(a, b) { return b.dy - a.dy; });

	// add the link titles
	  link.append("title")
			.text(function(d) {
				return d.source.name + " → " + 
					d.target.name + "\n" + format(d.value); });

	// add in the nodes
	  var node = svgNhl.append("g").selectAll(".node")
		  .data(graph.nodes)
		.enter().append("g")
		  .attr("class", "node")
		  .attr("transform", function(d) { 
			  return "translate(" + d.x + "," + d.y + ")"; })
		.call(d3.behavior.drag()
		  .origin(function(d) { return d; })
		  .on("dragstart", function() { 
			  this.parentNode.appendChild(this); })
		  .on("drag", dragmove));

	// add the rectangles for the nodes
	  node.append("rect")
		  .attr("height", function(d) { return (d.dy); })
		  .attr("width", sankey.nodeWidth())
		  .style("fill", function(d) { 
			  return d.color = color(d.name.replace(/ .*/, "")); })
		  .style("stroke", function(d) { 
			  return d3.rgb(d.color).darker(2); })
		.append("title")
		  .text(function(d) { 
			  return d.name; });

	// add in the title for the nodes
	  node.append("text")
		  .attr("x", -6)
		  .attr("y", function(d) { return d.dy / 2; })
		  .attr("dy", ".35em")
		  .attr("text-anchor", "end")
		  .attr("transform", null)
		  .text(function(d) { return d.name; })
		.filter(function(d) { return d.x < width / 2; })
		  .attr("x", 6 + sankey.nodeWidth())
		  .attr("text-anchor", "start");

	// the function for moving the nodes
	  function dragmove(d) {
		d3.select(this).attr("transform", 
			"translate(" + d.x + "," + (
					d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))
				) + ")");
		sankey.relayout();
		link.attr("d", path);
	  }
	});

</script>





<svg class="nflBar"></svg>
<p>That's it, folks!</p>
<script>

var nflBarWidth = 200,
    nlfBarHeight = 200;

var y = d3.scale.linear()
    .range([nlfBarHeight, 0]);

var chart = d3.select(".nflBar")
    .attr("width", nflBarWidth)
    .attr("height", nlfBarHeight);

d3.csv("nflBar.csv", type, function(error, data) {
  y.domain([0, d3.max(data, function(d) { return d.value; })]);

  var barWidth = nflBarWidth / data.length;

  var bar = chart.selectAll("g")
      .data(data)
    .enter().append("g")
      .attr("transform", function(d, i) { return "translate(" + i * barWidth + ",0)"; });

  bar.append("rect")
      .attr("y", function(d) { return y(d.value); })
      .attr("height", function(d) { return nlfBarHeight - y(d.value); })
      .attr("width", barWidth - 1)
      .attr("class", "bar") ;

  bar.append("text")
      .attr("x", barWidth / 2)
      .attr("y", nlfBarHeight)
      .attr("dy", "-.25em")
      .text(function(d) { return Math.round((d.value).toFixed(2)*100) + '%'; });
});

function type(d) {
  d.value = +d.value; // coerce to number
  return d;
}

</script>







</html>
